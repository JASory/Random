/*
     Approximation of prime-counting function. 
     Utilizes research on function bounds due to Pierre Dusart and Christian Axler, in addition to tables computed by
     Tomas Oliviera de Silva and Douglas Staple. Among the most accurate approximation of pi(n) to date. 
     
     ~J.A. Sory
 */

fn pi_92(n: u128) -> u128 {
 
 const COEF : [f64;92] = [
 -2084.3501076577672, -87.77121341817872, -17.20695071636901, -6.260740429505511,
 -2.903487311045525,-1.890553277481714, -1.4285825530550667, -1.250470469650299,
 -0.8338009109661932, -0.8706301981954359,-0.9242337213588292, -0.6040971931495265,
 -0.8871105604590352, -0.41616419938107296, -2.010001644218188,-2.1204841370521588,
 -1.8239234508335516, -2.2967480095446184, -1.677978095297996, -2.449372877325449,
 -2.2555702908574595, -2.358975487445901, -2.859277350695613, -3.266988608763069,
 -2.1620410937247483,-3.247265527920461, -4.039062588147251, -3.622825596168969,
 -4.8913431437372275, -3.5754918615033517,-5.3712251617229585, -6.248681042318215,
 -4.5254603697231115, -5.407259254975256, -8.847133150715091,-8.917424915387985,
 -8.282242432303432, -9.419626449921468, -8.222760079704242, -10.723530841137379,
 -14.501336856231335, -8.896620738553882, -14.468197457716581, -12.543450624506479,
 -20.880504882511566,-7.491291432773588, -6.729789628815966, -23.762449811034706,
 -24.718202713941487, -19.12185255863229, -26.716486795998, -5.3230793895816735,
 1.0661628410523363, -28.636389873003406, -6.866006108454639, 14.176302493387384,
 3.8382230223716562, 41.815936575032914, 85.69503867401643, 132.85871162267853, 
 154.21491321936065, 279.74798501901637, 334.3108245300522, 530.585926858357,
 681.0083476230019, 954.2941738900806, 1379.2204889453412,1756.0698715601468,
 2452.1902268950944, 3207.3393943903634,4453.776794805113, 5940.284418939542,
 7868.929210353102,10645.487303232776, 14017.38538927592, 18456.536639036985,
 24459.580857450866, 31982.127695788502,41842.053898160295, 54297.03225910177, 
 69305.09566876457, 88009.9282167423, 110246.60753696041, 135244.10891750705,
 161734.67675270137, 185686.19801276823, 201897.07725098977,194422.40872244426,
 144929.64418431942, 14199.703035223905, -257600.43722223098, -775043.102097448

  ]; 
  
   let x = n as f64; 
   let ln = x.ln();
   let inv_ln = ln.recip();
   
   let lo = match(){
   _ if n <= 19423 => x/(ln - 1.0 - inv_ln - (3.0/ln.powi(2) - (87.0/ln.powi(3))) ),
   _ => x/ln + x/ln.powi(2) + 2.0*x/ln.powi(3) + 5.85*x/ln.powi(4) + 23.85*x/ln.powi(5) 
        + 119.25*x/ln.powi(6) + 715.5*x/ln.powi(7) + 5008.5*x/ln.powi(8), 
  }; 
  
  let hi = x/ln + x/ln.powi(2) + 2.0*x/ln.powi(3) + 6.15*x/ln.powi(4) + 24.15*x/ln.powi(5) 
           + 120.75*x/ln.powi(6) + 724.25*x/ln.powi(7) + 6601.0*x/ln.powi(8);
  
  let mut coef = 0f64;
  let idx = (127-n.leading_zeros()) as usize;
  
  if idx < 93 {
   coef = COEF[idx-1];
   }
   
  (((lo + hi)/2.0) + coef*hi.cbrt()).round() as u128
 
 } 
